<html>
<head>
<script src="https://aframe.io/releases/0.6.1/aframe.min.js"></script>
<script src="https://jeromeetienne.github.io/AR.js/aframe/build/aframe-ar.min.js"></script>
<script>THREEx.ArToolkitContext.baseURL = 'https://jeromeetienne.github.io/AR.js/three.js/'</script>
<script>
AFRAME.registerComponent('transparent-texture', {
	
	init: function () {
		this.applyToMesh();
		this.el.addEventListener('model-loaded', () => this.applyToMesh());
	},
	
	applyToMesh: function() {
		const mesh = this.el.getObject3D('mesh');
		if (mesh)
			mesh.traverse( function( child ) {
				if ( child.isMesh )
				{
					child.material.transparent = true;
					child.material.alphaTest = 0.5;
				}
			});
	}
	
});

var move_interval = null;

window.onload = function(){
	
	if(move_interval) clearInterval(move_interval);
	
	var camera = document.getElementById('camera');
	
	move_interval = setInterval(function(){
		var p = camera.getAttribute('position');
		console.log('camera position', p);
		p.x += (Math.random()-0.5)*10;
		p.z += (Math.random()-0.5)*10;
		console.log('new camera position', p);
		camera.setAttribute('position', p);
	}, 3000);
	
}

</script>
</head>
<body style='margin: 0px; overflow: hidden;'>
	<a-scene embedded artoolkit='sourceType: webcam;'>
		
		<a-assets>
			<a-asset-item id="fence" src="fence11.dae"></a-asset-item>
		</a-assets>
		
		<a-entity collada-model="#fence" transparent-texture></a-entity>
		
		
		<a-camera id="camera" user-height="1.6"></a-camera>
		
	</a-scene>
</body>
</html>
